(function(){var HttpPromise,Request,RequestFormat;RequestFormat={json:{headers:{"Content-Type":"application/json",Accept:"application/json"},encode:function(data){var str;try{str=JSON.stringify(data)}catch(undefined){}return str},parse:function(xhr){var data;try{data=JSON.parse(xhr.response)}catch(undefined){}return{data:data,xhr:xhr}}},formData:{encode:function(input){var form;form=typeof input==="string"?document.querySelector(input):input;return new FormData(form)},parse:function(xhr){return{data:xhr.response,xhr:xhr}}}};HttpPromise=function(){HttpPromise.format=function(name){return RequestFormat[name]};HttpPromise.setFormat=function(name,options){return RequestFormat[name]=options};function HttpPromise(config){var base;if(config==null){config={}}this.config=config;(base=this.config).type||(base.type="json")}HttpPromise.prototype.get=function(url,params){var k,q,qs,v;if(params){q=[];for(k in params){v=params[k];q.push(k+"="+v)}qs="?"+q.join("&");url=encodeURI(url+qs)}return this.request("get",url)};HttpPromise.prototype.post=function(url,data){return this.request("post",url,data)};HttpPromise.prototype.put=function(url,data){return this.request("put",url,data)};HttpPromise.prototype.patch=function(url,data){return this.request("patch",url,data)};HttpPromise.prototype["delete"]=function(url,data){return this.request("delete",url,data)};HttpPromise.prototype.request=function(method,url,data){return new Request(this.config,method,url,data)};return HttpPromise}();Request=function(){function Request(config,method,url,data){var format;format=RequestFormat[config.type];if(config.headers!=null&&typeof config.headers!=="object"){throw new TypeError("If given, headers must an object where each key value pair represents a request header")}this.promise=new Promise(function(fulfill,reject){var k,ref,ref1,request,v;request=new XMLHttpRequest;request.onload=function(){return fulfill(format.parse(this))};request.onerror=function(){return reject({state:"ERROR",xhr:this})};request.onabort=function(){return reject({state:"ABORT",xhr:this})};request.ontimeout=function(){return reject({state:"TIMEOUT",xhr:this})};request.open(method.toUpperCase(),url,true);ref=format.headers;for(k in ref){v=ref[k];request.setRequestHeader(k,v)}if(config.headers){ref1=config.headers;for(k in ref1){v=ref1[k];request.setRequestHeader(k,v)}}if(data){return request.send(format.encode(data))}else{return request.send()}})}Request.prototype.then=function(fn){this.promise.then(function(r){return fn(r.data,r.xhr)});return this};Request.prototype.when=function(status,fn){this.promise.then(function(r){if(r.xhr.status===status){return fn(r.data,r.xhr)}});return this};Request.prototype.success=function(fn){this.promise.then(function(r){if(r.xhr.status>=200&&r.xhr.status<300){return fn(r.data,r.xhr)}});return this};Request.prototype.error=function(fn){var fulfill,reject;fulfill=function(r){if(r.xhr.status<200||r.xhr.status>=300){return fn(r.data,r.xhr)}};reject=function(r){return fn(r.data,r.xhr)};this.promise.then(fulfill,reject);return this};return Request}();if(typeof module!=="undefined"&&module!==null){module.exports=HttpPromise}else{window.HttpPromise=HttpPromise}}).call(this);